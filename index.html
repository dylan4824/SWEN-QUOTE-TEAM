<html>
  <head>
    <title>NEETball analysis</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <!--<script src="jquery-2.1.4.min.js" charset="utf-8"></script>-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  </head>
    <body>
	    <table align="center">
	    	<tr>
	    		<td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">
			    	Round
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu " role="menu1" aria-labelledby="menu1">
			      <li role="presentation" onclick="disableElem('menu11')"  id="menu11"> <a role="menuitem" tabindex="-1">1</a></li>
			      <li role="presentation" onclick="disableElem('menu12')"  id="menu12"> <a role="menuitem" tabindex="-1">2</a></li>
			      <li role="presentation" onclick="disableElem('menu13')"  id="menu13"> <a role="menuitem" tabindex="-1">3</a></li>
			      <li role="presentation" onclick="disableElem('menu14')"  id="menu14"> <a role="menuitem" tabindex="-1">4</a></li>
			      <li role="presentation" onclick="disableElem('menu15')"  id="menu15"> <a role="menuitem" tabindex="-1">5</a></li>
			      <li role="presentation" onclick="disableElem('menu16')"  id="menu16"> <a role="menuitem" tabindex="-1">6</a></li>
			      <li role="presentation" onclick="disableElem('menu17')"  id="menu17"> <a role="menuitem" tabindex="-1" >7</a></li>
			      <li role="presentation" onclick="disableElem('menu18')"  id="menu18"> <a role="menuitem" tabindex="-1" >8</a></li>
			      <li role="presentation" onclick="disableElem('menu19')"  id="menu19"> <a role="menuitem" tabindex="-1" >9</a></li>
			      <li role="presentation" onclick="disableElem('menu110')" id="menu110"><a role="menuitem" tabindex="-1" >10</a></li>
			      <li role="presentation" onclick="disableElem('menu111')" id="menu111"><a role="menuitem" tabindex="-1" >11</a></li>
			      <li role="presentation" onclick="disableElem('menu112')" id="menu112"><a role="menuitem" tabindex="-1" >12</a></li>
			      <li role="presentation" onclick="disableElem('menu113')" id="menu113"><a role="menuitem" tabindex="-1" >13</a></li>
			      <li role="presentation" onclick="disableElem('menu114')" id="menu114"><a role="menuitem" tabindex="-1" >14</a></li>
			      <li role="presentation" onclick="disableElem('menu115')" id="menu115"><a role="menuitem" tabindex="-1" >15</a></li>
			      <li role="presentation" onclick="disableElem('menu116')" id="menu116"><a role="menuitem" tabindex="-1" >16</a></li>
			      <li role="presentation" onclick="disableElem('menu117')" id="menu117"><a role="menuitem" tabindex="-1" >17</a></li>
			    </ul>
			</td>
			<!--------------------------------------------->
			<td class="dropdown">
		    	<button class="btn btn-default dropdown-toggle" type="button" id="menu2" data-toggle="dropdown">
		    		Season
		    		<span class="caret">
		    		</span>
			    </button>
			    <ul class="dropdown-menu" role="menu2" aria-labelledby="menu2">
			    	<li role="presentation" onclick="disableElem('menu21')" id="menu21"><a role="menuitem" tabindex="-1" >2008</a></li>
			    	<li role="presentation" onclick="disableElem('menu22')" id="menu22"><a role="menuitem" tabindex="-1" >2009</a></li>
			    	<li role="presentation" onclick="disableElem('menu23')" id="menu23"><a role="menuitem" tabindex="-1" >2010</a></li>
			    	<li role="presentation" onclick="disableElem('menu24')" id="menu24"><a role="menuitem" tabindex="-1" >2011</a></li>
			    	<li role="presentation" onclick="disableElem('menu25')" id="menu25"><a role="menuitem" tabindex="-1" >2012</a></li>
			    	<li role="presentation" onclick="disableElem('menu26')" id="menu26"><a role="menuitem" tabindex="-1" >2013</a></li>
			    </ul>
			</td>
			  <!--------------------------------------------->
			  <td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu3" data-toggle="dropdown">
			    	Home Team
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu" role="menu3" aria-labelledby="menu3">
			    	<li role="presentation" onclick="disableElem('menu31')" id="menu31"><a role="menuitem" tabindex="-1" >Northern Mystics</a></li>
			    	<li role="presentation" onclick="disableElem('menu32')" id="menu32"><a role="menuitem" tabindex="-1" >Queensland Firebirds</a></li>
			    	<li role="presentation" onclick="disableElem('menu33')" id="menu33"><a role="menuitem" tabindex="-1" >Southern Steel</a></li>
			    	<li role="presentation" onclick="disableElem('menu34')" id="menu34"><a role="menuitem" tabindex="-1" >Canturybury Tactix</a></li>
			    	<li role="presentation" onclick="disableElem('menu35')" id="menu35"><a role="menuitem" tabindex="-1" >Melbourne Vixens</a></li>
			    	<li role="presentation" onclick="disableElem('menu36')" id="menu36"><a role="menuitem" tabindex="-1" >Central Pulse</a></li>
			    	<li role="presentation" onclick="disableElem('menu37')" id="menu37"><a role="menuitem" tabindex="-1" >Adelaide Thunderbirds</a></li>
			    	<li role="presentation" onclick="disableElem('menu38')" id="menu38"><a role="menuitem" tabindex="-1" >Waikato Bay of Plenty Magic</a></li>
			    	<li role="presentation" onclick="disableElem('menu39')" id="menu39"><a role="menuitem" tabindex="-1" >West Coast Fever</a></li>
			    	<li role="presentation" onclick="disableElem('menu310')" id="menu310"><a role="menuitem" tabindex="-1" >New South Wales Swifts</a></li>
			    </ul>
			</td>
			  <!--------------------------------------------->
			  <td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu4" data-toggle="dropdown">
			    	Away Team
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu" role="menu4" aria-labelledby="menu4">
			    	<li role="presentation" onclick="disableElem('menu41')" id="menu41"><a role="menuitem" tabindex="-1" >Northern Mystics</a></li>
			    	<li role="presentation" onclick="disableElem('menu42')" id="menu42"><a role="menuitem" tabindex="-1" >Queensland Firebirds</a></li>
			    	<li role="presentation" onclick="disableElem('menu43')" id="menu43"><a role="menuitem" tabindex="-1" >Southern Steel</a></li>
			    	<li role="presentation" onclick="disableElem('menu44')" id="menu44"><a role="menuitem" tabindex="-1" >Canturybury Tactix</a></li>
			    	<li role="presentation" onclick="disableElem('menu45')" id="menu45"><a role="menuitem" tabindex="-1" >Melbourne Vixens</a></li>
			    	<li role="presentation" onclick="disableElem('menu46')" id="menu46"><a role="menuitem" tabindex="-1" >Central Pulse</a></li>
			    	<li role="presentation" onclick="disableElem('menu47')" id="menu47"><a role="menuitem" tabindex="-1" >Adelaide Thunderbirds</a></li>
			    	<li role="presentation" onclick="disableElem('menu48')" id="menu48"><a role="menuitem" tabindex="-1" >Waikato Bay of Plenty Magic</a></li>
			    	<li role="presentation" onclick="disableElem('menu49')" id="menu49"><a role="menuitem" tabindex="-1" >West Coast Fever</a></li>
			    	<li role="presentation" onclick="disableElem('menu410')" id="menu410"><a role="menuitem" tabindex="-1" >New South Wales Swifts</a></li>
			    </ul>
			</td>
			<!--------------------------------------------->

			  <td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu5" data-toggle="dropdown">
			    	Overtime
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu" role="menu5" aria-labelledby="menu5">
            <li role="presentation" onclick="disableElem('menu51')" id="menu51"><a role="menuitem" tabindex="-1" >True</a></li>
            <li role="presentation" onclick="disableElem('menu52')" id="menu52"><a role="menuitem" tabindex="-1" >False</a></li>
			    </ul>
			</td>
			    	<!--------------------------------------------->
<!--
  REMOVED DUE TO TIME CONTRAINTS
	<td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu10" data-toggle="dropdown">
			    	Wins
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu" role="menu11" aria-labelledby="menu10">

			    </ul>
			</td>
			  <!---------------------------------------------
			  <td class="dropdown">
			    <button class="btn btn-default dropdown-toggle" type="button" id="menu11" data-toggle="dropdown">
			    	Losses
			    	<span class="caret">
			    	</span>
			    </button>
			    <ul class="dropdown-menu" role="menu11" aria-labelledby="menu11">
-->
			    </ul>
			</td>
		</tr>
	</table>
  <p align="center">
    <svg width=1000 height=800 id="graphElem"></svg>
  </p>
	<script>
	var tables = ["2008-Table1.csv",
	      "2009-Table1.csv",
	      "2010-Table1.csv",
	      "2011-Table1.csv",
	      "2012-Table1.csv",
	      "2013-Table1.csv"
	     ]

	var tableData = new Array()

	var windowSize = window;
	var windWidth = windowSize.innerWidth;
	var windHeight = windowSize.innerHeight;
	var teams = ["Adelaide Thunderbirds", "Melbourne Vixens", "New South Wales Swifts",
				"Queensland Firebirds", "West Coast Fever", "Canterbury Tactix", "Central Pulse", "Northern Mystics", "Southern Steel", "Waikato Bay of Plenty Magic"];
	var canvas = initialiseCanvas();

	drawGraph(teams);
	readData()

	setTimeout(doAllTheThings, 0);
  function doAllTheThings(){
		console.log(tableData)
		var stats = []
		for(var i = 0; i < tableData.length; i++){
			stats[i] = mapStatistics(i)
		}
		console.log(stats)
	}


function readData(){
	for(var i = 0; i < tables.length; i++){
		readYear(i)
	}
}

function readYear (i){
	d3.csv( tables[i], function(d) {
		if(d.Score != ""){
			return{
				Round: d.Round,
				Date: d.Date,
				Year: tables[i].replace(/(^\d+)(.+$)/i,'$1'),
				HomeTeam: d['Home Team'],
				AwayTeam: d['Away Team'],
				HomeScore: d.Score.match(/^\d+|\d+\b|\d+(?=\w)/g)[0],
				AwayScore: d.Score.match(/^\d+|\d+\b|\d+(?=\w)/g)[1],
				Overtime:  d.Score.match(/^\d+|\d+\b|\d+(?=\w)/g)[3] != null,
				Venue: d.Venue,
				Winner: winner(d.Score.match(/^\d+|\d+\b|\d+(?=\w)/g)[0], d.Score.match(/^\d+|\d+\b|\d+(?=\w)/g)[1], d['Home Team'], d['Away Team']),
        Disabled: []
			};
		}
    },function(error, table){
		//console.log(table)
		tableData.push(table)
		//console.log(tableData)
	});
}

 function mapStatistics(index){
	var stat = {
		'Adelaide Thunderbirds': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Melbourne Vixens': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'New South Wales Swifts': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Queensland Firebirds': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'West Coast Fever': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Canterbury Tactix': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Central Pulse': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Northern Mystics': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Southern Steel': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		},
		'Waikato Bay of Plenty Magic': {
			Wins: 0,
			Overtimes : 0,
			TotalScore: 0
		}
	}

	for(var i = 0; i < tableData[index].length; i++){
		if(tableData[index][i].Winner != null){
			stat[tableData[index][i].Winner].Wins += 1;
		}
		stat[tableData[index][i].HomeTeam].TotalScore = parseInt(stat[tableData[index][i].HomeTeam].TotalScore) + parseInt(tableData[index][i].HomeScore)
		stat[tableData[index][i].AwayTeam].TotalScore = parseInt(stat[tableData[index][i].AwayTeam].TotalScore) + parseInt(tableData[index][i].AwayScore)
		if(tableData[index].Overtime){
			stat[tableData[index][i].HomeTeam].Overtimes += 1
			stat[tableData[index][i].AwayTeam].Overtimes += 1
		}
	}
	return stat;

}

function winner(HomeScore, AwayScore, HomeTeam, AwayTeam){
  if(HomeScore > AwayScore){
    return HomeTeam
  }
  else if (HomeScore == AwayScore) {
    return null
  }
  return AwayTeam

}

function initialiseCanvas() {

	return d3.select("body")
		.append("svg")
		.attr("width", windWidth*0.8)
		.attr("height", windHeight*0.6);
}

function drawGraph(teamName) {
	drawLine()
	for (var i = 0; i < teamName.length; i++) {
		drawImg(0.1*windHeight, 0.1*windWidth, 100, i*50, "resources/" + teamName[i] + ".png");
	}
}

function getTotalScores(data) {
}

function drawRect(width, height, x, y, color){
	return canvas.append("rect")
		.attr("width", width)
		.attr("height", height)
		.attr("x", x)
		.attr("y", y)
		.attr("color", color);
}

function drawLine(x1, x2, y1, y2, color){
	return canvas.append("line")
		.attr("x1", x1)
		.attr("x2", x2)
		.attr("y1", y1)
		.attr("y2", y2)
		.attr("color", color);
}

function drawImg(width, height, x, y, imgLink){
	return canvas.append("image")
		.attr("width", width)
		.attr("height", height)
		.attr("x", x)
		.attr("y", y)
		.attr("xlink:href", imgLink);
}

function disableElem(id){
  var element = d3.select("#"+id)
  console.log(id);
  var type;

  switch (id[4]){   //the key for each type
    case "1":
    type = "Round"
    break;
    case "2":
    type = "Season"
    break;
    case "3":
    type = "HomeTeam"
    break;
    case "4":
    type = "AwayTeam"
    break;
    default:
    type = "Overtime"
    break;
  }
  console.log(type);
  var value = element.selectAll("a")[0][0].innerHTML

  switch (type){
    case "Round":
    disableRound(value,id,element)
    break;
    case "Season":
    disableSeason(value,id,element)
    break;
    case "HomeTeam":
    disableHomeTeam(value,id,element)
    break;
    case "AwayTeam":
    disableAwayTeam(value,id,element)
    break;
    default:
    doOvertime(value)
    break;
  }

  //element.attr("class","disabled")
  //console.log(element.attr("class"))
}

function removeArrayElem(array, elem){
  array.splice(array.indexOf(elem),1)
}

function disableRound(value,id,elem){
  console.log(value);
  for (var i = 0; i < tableData.length; i++) {
    for(var k = 0; k < tableData[1].length; k++){

      if(tableData[i][k].Round == value){
        if((tableData[i][k].Disabled.length > 1) && !(tableData[i][k].Disabled.indexOf(id) == -1)){
            for (var e = 0; e < tableData[i][k].Disabled.length; e++) {
              console.log("in removal");
              if(tableData[i][k].Disabled[e] == id){
                removeArrayElem(tableData[i][k].Disabled,id)
              }
            }
        }
        else if((tableData[i][k].Disabled.length == 1) && (tableData[i][k].Disabled[0] == [id])){
          elem.attr("class",null)
          removeArrayElem(tableData[i][k].Disabled,id)
        }
        else{
          elem.attr("class","disabled")
          tableData[i][k].Disabled.push(id)
        }

      }
    }
  }
}

function disableSeason(value,id,elem){
  value = value - 2008;
  for(var i = 0; i < tableData[value].length;i++){
      if((tableData[value][i].Disabled.length > 1) && !(tableData[value][i].Disabled.indexOf(id) == -1)){
          for (var e = 0; i < tableData[value][i].Disabled.length; e++) {
            if(tableData[value][i].Disabled[e] == id){
                removeArrayElem(tableData[i][k].Disabled,id)
            }
          }
      }
      else if((tableData[value][i].Disabled.length == 1) && (tableData[value][i].Disabled[0] == [id])){
        elem.attr("class",null)
        removeArrayElem(tableData[value][i].Disabled,id)
      }
      else{
        elem.attr("class","disabled")
        tableData[value][i].Disabled.push(id)
      }
  }
}

function disableHomeTeam(value,id,elem){
  for (var i = 0; i < tableData.length; i++) {
    for(var k = 0; k < tableData[1].length; k++){

      if(tableData[i][k].HomeTeam == value){
        if((tableData[i][k].Disabled.length > 1) && !(tableData[i][k].Disabled.indexOf(id) == -1)){
            for (var e = 0; e < tableData[i][k].Disabled.length; e++) {
              console.log("in removal");
              if(tableData[i][k].Disabled[e] == id){
                removeArrayElem(tableData[i][k].Disabled,id)
              }
            }
        }
        else if((tableData[i][k].Disabled.length == 1) && (tableData[i][k].Disabled[0] == [id])){
          elem.attr("class",null)
          removeArrayElem(tableData[i][k].Disabled,id)
        }
        else{
          elem.attr("class","disabled")
          tableData[i][k].Disabled.push(id)
        }

      }
    }
  }

}

function disableAwayTeam(value){
  for (var i = 0; i < tableData.length; i++) {
    for(var k = 0; k < tableData[1].length; k++){

      if(tableData[i][k].AwayTeam == value){
        if((tableData[i][k].Disabled.length > 1) && !(tableData[i][k].Disabled.indexOf(id) == -1)){
            for (var e = 0; e < tableData[i][k].Disabled.length; e++) {
              console.log("in removal");
              if(tableData[i][k].Disabled[e] == id){
                removeArrayElem(tableData[i][k].Disabled,id)
              }
            }
        }
        else if((tableData[i][k].Disabled.length == 1) && (tableData[i][k].Disabled[0] == [id])){
          elem.attr("class",null)
          removeArrayElem(tableData[i][k].Disabled,id)
        }
        else{
          elem.attr("class","disabled")
          tableData[i][k].Disabled.push(id)
        }

      }
    }
  }
}

function doOvertime(value){}

	  </script>
    </body>
</html>
